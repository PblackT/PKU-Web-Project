<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>File manager</title>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<script src="/Main_action.js"></script>
</head>
<body>
	<button id='Dload'>Download</button><br>
	<button id='Bpage'>Go up one directory</button><br>
	<button id='Nfolder'>New Folder</button><br>
	<button id='Gbuild'>Build your group</button><br>
    <button id='Gcheck'>Check your group</button><br>
    <ul id='file_list'>
    </ul>
	<form>
        <p>文件: <input id="file" name="file" type="file" /></p>
        <p><button id="Uload" type="button">上传</button></p>
    </form>
</body>

<!--Display the files-->
<script>
	var token = localstorage.value;
	var path = window.location.href.split('/')[-1].split('?')[0];
	var auth = new URLSearchParams();
	var params = new URLSearchParams();
    var formData = new FormData();
    auth.append("token", token);
    params.append("func", "ls");
    params.append("path", path);
    formData.append("auth", auth);
    formData.append("params", params);

    // Request for contents
    $.ajax({
        async: false,
        url: "/cgi-bin/serve.py", 
        type: "POST",
        data: formData_,
        processData: false,
        contentType: false,
        success: function (response) {
            var json = JSON.parse(response);
            var files = JSON.parse(json.list);
            if(json.errno==1)
                alert("An error occurs");
            else {
                Display_the_files(files);
            }                              
        },
        error: function (xhr) {
            alert(xhr.status + " " + xhr.statusText + "\n"
                + xhr.responseText);
        }
    });
</script>

<!--The Buttons-->
<script>
	$("#Dload").click(Download());
	$("#Uload").click(Upload($("#file"),$("#proc")));
	$("#Bpage").click(Backpage(window.location.href.split('/')[:-2].join('/')));
	$("#Nfolder").click(Makedir());
	$("#Gbuild").click();
	$("#Gcheck").click();
</script>
</html>